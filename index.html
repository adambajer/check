<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OKbase + UAParser.js Demo</title>
  <style>
    body {
      margin: 1rem;
      font-family: Arial, sans-serif;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #ccc;
      border-top-color: #0078d7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Markers for checks */
    .mark {
      font-weight: bold;
    }
    .ok {
      color: green;
    }
    .unknown {
      color: orange; /* For the question mark or failing checks */
    }

    /* Link styling */
    .link a {
      color: blue; 
      text-decoration: underline;
    }

    /* Responsive tweak */
    @media (max-width: 600px) {
      body {
        font-size: 0.95rem;
      }
      .spinner {
        width: 30px;
        height: 30px;
      }
    }
  </style>
</head>
<body>

<!-- 1) Load UAParser.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/ua-parser-js@0.7.31/dist/ua-parser.min.js"></script>

<script>
  /* 
    This script:
    - Creates a spinner
    - After a short delay, parses the user agent
    - Shows main <h1>, then a "Kontrola požadavků" section, 
      then "Ke stažení" section
    - Checks both Microsoft Edge and the Company Portal 
      in each OS scenario
    - For the Company Portal check row, we always show 
      an orange question mark (?) since we can't detect installation
    - Finally, we have a link to OKbase
  */

  // Create a loading spinner
  const spinner = document.createElement('div');
  spinner.className = 'spinner';
  document.body.appendChild(spinner);

  // Simulate a small loading delay
  setTimeout(() => {
    runDetection();
  }, 500);

  function runDetection() {
    // Remove spinner
    document.body.removeChild(spinner);

    // Parse user agent
    const parser = new UAParser();
    const result = parser.getResult();

    // If no result or empty
    if (!result || Object.keys(result).length === 0) {
      const failH1 = document.createElement('h1');
      failH1.textContent = 'X - Detekce selhala';
      document.body.appendChild(failH1);
      return;
    }

    // Explicit check for Chromium-based Edge
    if (result.browser.name === 'Chrome' && /Edg\/\d+/.test(navigator.userAgent)) {
      result.browser.name = 'Edge';
      result.browser.version = navigator.userAgent.match(/Edg\/(\d+)/)[1];
    }

    const osFamily      = result.os.name ? result.os.name.toLowerCase() : 'unknown';
    const browserFamily = result.browser.name ? result.browser.name.toLowerCase() : 'unknown';

    // Main headline
    const h1 = document.createElement('h1');
    document.body.appendChild(h1);

    // Decide headline text
    if (osFamily.includes('android')) {
      h1.textContent = 'OKbase na zařízení Android';
      displayAndroidChecks(result);

    } else if (osFamily.includes('ios') || osFamily.includes('mac os')) {
      h1.textContent = 'OKbase na zařízení Apple';
      displayAppleChecks(browserFamily);

    } else if (osFamily.includes('windows')) {
      h1.textContent = 'OKbase na zařízení Windows';
      displayWindowsChecks(browserFamily);

    } else {
      h1.textContent = 'X - Neznámé zařízení';
    }

    // Finally, separate with an <hr> and link to OKbase
    const hr = document.createElement('hr');
    document.body.appendChild(hr);

    const okbaseLink = document.createElement('div');
    okbaseLink.innerHTML = `
      <a href="https://okbase2.miele.com" target="_blank">Přejít na OKbase</a>
    `;
    document.body.appendChild(okbaseLink);
  }

  /* -----------------------------------------------------------------------
     ANDROID CHECKS
  ------------------------------------------------------------------------ */
  function displayAndroidChecks(result) {
    // 1) Kontrola požadavků
    const reqH2 = document.createElement('h2');
    reqH2.textContent = 'Kontrola požadavků';
    document.body.appendChild(reqH2);

    const container = document.createElement('div');

    // Minimální verze Android 10
    const verOK = result.os.version && parseInt(result.os.version, 10) >= 10;
    container.appendChild(createCheckRow('Minimální verze Android 10', verOK));

    // Volné místo 140 MB => pretend it's OK
    container.appendChild(createCheckRow('Volné místo 140 MB', true));

    // Microsoft Edge
    const edgeInstalled = (result.browser.name && result.browser.name.toLowerCase() === 'edge');
    container.appendChild(createCheckRow('Microsoft Edge', edgeInstalled));

    // Company Portal => We CANNOT detect installation => show an orange "?"
    // We'll treat it as "unknown" state
    container.appendChild(createCheckRowPortal('Portál společnosti'));

    document.body.appendChild(container);

    // 2) Ke stažení
    const dlH2 = document.createElement('h2');
    dlH2.textContent = 'Ke stažení';
    document.body.appendChild(dlH2);

    const dlContainer = document.createElement('div');

    // If Edge not installed => show link
    if (!edgeInstalled) {
      const edgeLink = document.createElement('div');
      edgeLink.className = 'link';
      edgeLink.innerHTML = `
        Stáhněte Microsoft Edge:
        <a href="https://play.google.com/store/apps/details?id=com.microsoft.emmx" target="_blank">
          Google Play
        </a>
      `;
      dlContainer.appendChild(edgeLink);
    }

    // Always show link to Company Portal
    const portalLink = document.createElement('div');
    portalLink.className = 'link';
    portalLink.innerHTML = `
      Stáhněte Portál společnosti:
      <a href="https://play.google.com/store/apps/details?id=com.microsoft.portal" target="_blank">
        Google Play
      </a>
    `;
    dlContainer.appendChild(portalLink);

    document.body.appendChild(dlContainer);
  }

  /* -----------------------------------------------------------------------
     APPLE (iOS/macOS) CHECKS
  ------------------------------------------------------------------------ */
  function displayAppleChecks(browserFamily) {
    // Kontrola požadavků
    const reqH2 = document.createElement('h2');
    reqH2.textContent = 'Kontrola požadavků';
    document.body.appendChild(reqH2);

    const container = document.createElement('div');

    // Check Microsoft Edge
    // iOS doesn't let us truly detect if it's installed,
    // but let's see if user agent claims "Edge".
    const edgeInstalled = (browserFamily === 'edge');
    container.appendChild(createCheckRow('Microsoft Edge', edgeInstalled));

    // Company Portal => we can't detect installation => "?"
    container.appendChild(createCheckRowPortal('Portál společnosti'));

    document.body.appendChild(container);

    // Ke stažení
    const dlH2 = document.createElement('h2');
    dlH2.textContent = 'Ke stažení';
    document.body.appendChild(dlH2);

    const dlContainer = document.createElement('div');

    // If Edge not "installed"
    if (!edgeInstalled) {
      const edgeLink = document.createElement('div');
      edgeLink.className = 'link';
      edgeLink.innerHTML = `
        Stáhněte Microsoft Edge:
        <a href="https://apps.apple.com/app/microsoft-edge/id1288723196" target="_blank">
          App Store
        </a>
      `;
      dlContainer.appendChild(edgeLink);
    }

    // Company Portal link
    const portalLink = document.createElement('div');
    portalLink.className = 'link';
    portalLink.innerHTML = `
      Stáhněte Portál společnosti:
      <a href="https://apps.apple.com/app/microsoft-company-portal/id719171358" target="_blank">
        App Store
      </a>
    `;
    dlContainer.appendChild(portalLink);

    document.body.appendChild(dlContainer);
  }

  /* -----------------------------------------------------------------------
     WINDOWS CHECKS
  ------------------------------------------------------------------------ */
  function displayWindowsChecks(browserFamily) {
    // Kontrola požadavků
    const reqH2 = document.createElement('h2');
    reqH2.textContent = 'Kontrola požadavků';
    document.body.appendChild(reqH2);

    const container = document.createElement('div');

    // Check Edge
    const edgeInstalled = (browserFamily === 'edge');
    container.appendChild(createCheckRow('Microsoft Edge', edgeInstalled));

    // Company Portal => can't detect => "?"
    container.appendChild(createCheckRowPortal('Portál společnosti'));

    document.body.appendChild(container);

    // Ke stažení
    const dlH2 = document.createElement('h2');
    dlH2.textContent = 'Ke stažení';
    document.body.appendChild(dlH2);

    const dlContainer = document.createElement('div');

    if (!edgeInstalled) {
      const edgeLink = document.createElement('div');
      edgeLink.className = 'link';
      edgeLink.innerHTML = `
        Stáhněte Microsoft Edge:
        <a href="https://www.microsoft.com/edge" target="_blank">Oficiální stránka</a>
      `;
      dlContainer.appendChild(edgeLink);
    }

    // Portal link
    const portalLink = document.createElement('div');
    portalLink.className = 'link';
    portalLink.innerHTML = `
      Stáhněte Portál společnosti:
      <a href="https://www.microsoft.com/store/productId/9WZDNCRFJ3PT" target="_blank">
        Oficiální stránka
      </a>
    `;
    dlContainer.appendChild(portalLink);

    document.body.appendChild(dlContainer);
  }

  /* -----------------------------------------------------------------------
     HELPER #1: createCheckRow(text, isOK)
     Creates a <div> with "Text: ✔️/❌"
  ------------------------------------------------------------------------ */
  function createCheckRow(text, isOK) {
    const row = document.createElement('div');
    row.textContent = text + ': ';

    const markSpan = document.createElement('span');
    markSpan.textContent = isOK ? '✔️' : '❌';
    markSpan.className = isOK ? 'mark ok' : 'mark unknown';

    row.appendChild(markSpan);
    return row;
  }

  /* -----------------------------------------------------------------------
     HELPER #2: createCheckRowPortal(text)
     Always an orange question mark, because JS can't detect installation
  ------------------------------------------------------------------------ */
  function createCheckRowPortal(text) {
    const row = document.createElement('div');
    row.textContent = text + ': ';

    const markSpan = document.createElement('span');
    markSpan.textContent = '?';
    markSpan.className = 'mark unknown'; // orange color
    row.appendChild(markSpan);

    // e.g. "Portál společnosti: ?"
    return row;
  }
</script>

</body>
</html>
