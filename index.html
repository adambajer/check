<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKbase na zařízení Android</title>
    <style>
        .checkmark {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .unknown {
            color: orange;
            font-weight: bold;
        }
        #details ul {
            list-style: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <h1>OKbase na zařízení Android</h1>
    <ul>
        <li>140MB volného místa <span id="storageCheck"></span></li>
        <li>Android 10 nebo vyšší <span id="androidCheck"></span></li>
        <li>Aplikace Microsoft Edge <span id="edgeCheck">❓</span></li>
        <li>Aplikace Portál společnosti <span id="companyPortalCheck">❓</span></li>
        <li>Zámek obrazovky <span id="screenLockCheck"></span></li>
    </ul>
    <div id="appLinks" style="display: none;">
        <p>Stáhněte požadované aplikace:</p>
        <ul>
            <li id="edgeLink" style="display: none;">
                <a href="https://play.google.com/store/apps/details?id=com.microsoft.emmx" target="_blank">Stáhnout Microsoft Edge</a>
            </li>
            <li id="companyPortalLink" style="display: none;">
                <a href="https://play.google.com/store/apps/details?id=com.microsoft.windowsintune.companyportal" target="_blank">Stáhnout Portál společnosti</a>
            </li>
        </ul>
    </div>
    <div id="link" style="display: none;">
        <a href="https://okbase2.miele.com" target="_blank">Přejít na OKbase</a>
    </div>
    <h2 id="detailsHeader">Co jsem o zařízení zjistil:</h2>
    <div id="details">
        <ul>
            <li>Operační systém: <span id="os"></span></li>
            <li>Prohlížeč: <span id="browser"></span></li>
            <li>Rozlišení obrazovky: <span id="screen"></span></li>
            <li>Verze Androidu: <span id="androidVersion">❓</span></li>
            <li>Volné místo na disku: <span id="storage">❓</span></li>
            <li>Zámek obrazovky: <span id="screenLock">❓</span></li>
        </ul>
    </div>

    <script>
        async function runCompleteTest() {
            let allChecksPassed = true;

            // Android version detection
            function getAndroidVersion() {
                const ua = navigator.userAgent.toLowerCase();
                const match = ua.match(/android\s([0-9\.]*)/i);
                return match ? parseFloat(match[1]) : undefined;
            }

            // User agent brand detection for Microsoft Edge
            async function isEdgeBrowser() {
                if (navigator.userAgentData && navigator.userAgentData.brands) {
                    const brands = navigator.userAgentData.brands;
                    return brands.some(brand => brand.brand.toLowerCase() === 'microsoft edge');
                }
                return /edg/i.test(navigator.userAgent);
            }

            // Detect OS and browser
            let os = "Neznámý OS";
            let browser = "Neznámý prohlížeč";

            if (/android/i.test(navigator.userAgent)) {
                os = "Android";
            } else if (/windows phone/i.test(navigator.userAgent)) {
                os = "Windows Phone";
            } else if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
                os = "iOS";
            } else if (/Macintosh/.test(navigator.userAgent)) {
                os = "Mac OS";
            } else if (/Windows/.test(navigator.userAgent)) {
                os = "Windows";
            } else if (/Linux/.test(navigator.userAgent)) {
                os = "Linux";
            }

            if (await isEdgeBrowser()) {
                browser = "Microsoft Edge";
            } else if (/chrome/i.test(navigator.userAgent) && !/edge/i.test(navigator.userAgent)) {
                browser = "Google Chrome";
            } else if (/safari/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent)) {
                browser = "Safari";
            } else if (/firefox/i.test(navigator.userAgent)) {
                browser = "Mozilla Firefox";
            } else if (/msie|trident/i.test(navigator.userAgent)) {
                browser = "Internet Explorer";
            }

            document.getElementById("os").innerText = os;
            document.getElementById("browser").innerText = browser;
            document.getElementById("screen").innerText = `${window.screen.width}x${window.screen.height}`;

            // Android version validation
            const androidVersion = getAndroidVersion();
            const androidCheck = document.getElementById("androidCheck");

            if (os === "Android" && androidVersion) {
                document.getElementById("androidVersion").innerText = androidVersion;
                if (androidVersion >= 10) {
                    androidCheck.innerHTML = "✔️";
                    androidCheck.classList.add("checkmark");
                } else {
                    androidCheck.innerHTML = "❌";
                    androidCheck.classList.add("error");
                    allChecksPassed = false;
                }
            } else {
                androidCheck.innerHTML = "❓";
                androidCheck.classList.add("unknown");
                allChecksPassed = false;
            }

            // Other checks (storage, screen lock)
            // Storage (simplified, as navigator.storage is limited)
            const storageCheck = document.getElementById("storageCheck");
            if (navigator.storage && navigator.storage.estimate) {
                const storage = await navigator.storage.estimate();
                const freeSpace = (storage.quota - storage.usage) / (1024 * 1024); // MB
                document.getElementById("storage").innerText = `${Math.round(freeSpace)} MB`;

                if (freeSpace >= 140) {
                    storageCheck.innerHTML = "✔️";
                    storageCheck.classList.add("checkmark");
                } else {
                    storageCheck.innerHTML = "❌";
                    storageCheck.classList.add("error");
                    allChecksPassed = false;
                }
            } else {
                storageCheck.innerHTML = "❓";
                allChecksPassed = false;
            }

            // Show links to apps if needed
            if (browser !== "Microsoft Edge") {
                document.getElementById("edgeLink").style.display = "block";
                document.getElementById("companyPortalLink").style.display = "block";
            }

            // Lock screen detection
            document.getElementById("screenLock").innerText = "Nelze zjistit (prohlížeč neumožňuje)";
            document.getElementById("screenLockCheck").innerHTML = "❓";

            // Final result: show OKbase link if all checks pass
            if (allChecksPassed) {
                document.getElementById("link").style.display = "block";
            }
        }

        runCompleteTest();
    </script>
</body>
</html>
