<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>OKbase na zařízení</title>
  <style>
    .checkmark {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .unknown {
      color: orange;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1 id="headline"></h1>
<!-- Nadpis: 
     "OKbase na zařízení Android" / 
     "OKbase na zařízení Apple" /
     "OKbase na zařízení Windows" 
-->

<ul>
  <li>Microsoft Edge: <span id="edgeCheck"></span></li>
  <li>Portál společnosti: <span id="companyCheck"></span></li>
</ul>

<!-- Odkazy ke stažení, zobrazené jen pokud je potřeba -->
<div id="appLinks" style="display:none;">
  <p>Doporučené aplikace:</p>
  <ul>
    <li id="edgeLink" style="display:none;">
      <a id="edgeLinkA" href="#" target="_blank">Stáhnout Microsoft Edge</a>
    </li>
    <li id="companyLink" style="display:none;">
      <a id="companyLinkA" href="#" target="_blank">Stáhnout Portál společnosti</a>
    </li>
  </ul>
</div>

<!-- Odkaz na OKbase, zobrazíme jen pokud je vše O.K. (?) 
     Případně ho zobrazíme vždy, je to na vás. 
-->
<div id="okbaseLink" style="display:none;">
  <a href="https://okbase2.miele.com" target="_blank">Přejít na OKbase</a>
</div>

<script>
// Detekce OS
function detectOS() {
  const ua = navigator.userAgent;

  if (/android/i.test(ua)) {
    return "Android";
  } else if (/iPad|iPhone|iPod/.test(ua)) {
    return "Apple";
  } else if (/Windows/i.test(ua)) {
    return "Windows";
  }
  return "Neznámé";
}

// Asynchronní zjištění, zda je to Edge
async function isEdgeBrowser() {
  // Moderní brand info:
  if (navigator.userAgentData && navigator.userAgentData.brands) {
    const brands = navigator.userAgentData.brands.map(b => b.brand.toLowerCase());
    return brands.includes('microsoft edge');
  }
  // Fallback:
  return /Edg\//i.test(navigator.userAgent);
}

// Stejně pro Portál společnosti, v reálu to nelze v prohlížeči zjistit,
// tak buď "není", a nabídneme link vždy, 
// nebo to necháme jen symbolicky. 
// Zde to "fake" => always false => dáme odkaz.
async function hasCompanyPortal() {
  // Nelze spolehlivě zjistit, předpokládáme false:
  return false;
}

document.addEventListener('DOMContentLoaded', async () => {
  const headline   = document.getElementById('headline');
  const edgeCheck  = document.getElementById('edgeCheck');
  const compCheck  = document.getElementById('companyCheck');
  const appLinks   = document.getElementById('appLinks');
  const edgeLink   = document.getElementById('edgeLink');
  const edgeLinkA  = document.getElementById('edgeLinkA');
  const companyLink= document.getElementById('companyLink');
  const companyLinkA= document.getElementById('companyLinkA');
  const okbaseLink = document.getElementById('okbaseLink');

  const os = detectOS();
  let allOk = true;

  // Nadpis
  if (os === "Android") {
    headline.textContent = "OKbase na zařízení Android";
    // Edge pro Android?
    const isEdge = await isEdgeBrowser();
    if (isEdge) {
      edgeCheck.innerHTML = "✔️";
      edgeCheck.classList.add("checkmark");
    } else {
      edgeCheck.innerHTML = "❌ (chybí Edge)";
      edgeCheck.classList.add("error");
      edgeLink.style.display = "list-item";
      // Odkaz do Google Play na Edge:
      edgeLinkA.href = "https://play.google.com/store/apps/details?id=com.microsoft.emmx";
      allOk = false;
    }

    // Portál společnosti
    const hasPortal = await hasCompanyPortal(); // false => odkaz
    if (hasPortal) {
      compCheck.innerHTML = "✔️";
      compCheck.classList.add("checkmark");
    } else {
      compCheck.innerHTML = "❌ (chybí Portál společnosti)";
      compCheck.classList.add("error");
      companyLink.style.display = "list-item";
      // Odkaz do Google Play na Company Portal
      companyLinkA.href = "https://play.google.com/store/apps/details?id=com.microsoft.windowsintune.companyportal";
      allOk = false;
    }

    // Zobrazíme <div> s links, pokud aspoň něco chybí
    if (!allOk) {
      appLinks.style.display = "block";
    }
    // Jestli allOk => zobrazíme OKbase link
    if (allOk) {
      okbaseLink.style.display = "block";
    }

  } else if (os === "Apple") {
    headline.textContent = "OKbase na zařízení Apple (iOS)";

    // Edge pro iOS?
    const isEdge = await isEdgeBrowser();
    if (isEdge) {
      edgeCheck.innerHTML = "✔️";
      edgeCheck.classList.add("checkmark");
    } else {
      edgeCheck.innerHTML = "❌ (chybí Edge)";
      edgeCheck.classList.add("error");
      edgeLink.style.display = "list-item";
      // Odkaz do App Store na Edge
      edgeLinkA.href = "https://apps.apple.com/us/app/microsoft-edge-web-browser/id1288723196";
      allOk = false;
    }

    // Portál společnosti
    const hasPortal = await hasCompanyPortal();
    if (hasPortal) {
      compCheck.innerHTML = "✔️";
      compCheck.classList.add("checkmark");
    } else {
      compCheck.innerHTML = "❌ (chybí Portál společnosti)";
      compCheck.classList.add("error");
      companyLink.style.display = "list-item";
      // Odkaz do App Store Company Portal
      companyLinkA.href = "https://apps.apple.com/us/app/intune-company-portal/id719725942";
      allOk = false;
    }

    // Zobrazíme <div> s links, pokud aspoň něco chybí
    if (!allOk) {
      appLinks.style.display = "block";
    }
    if (allOk) {
      okbaseLink.style.display = "block";
    }

  } else if (os === "Windows") {
    headline.textContent = "OKbase na zařízení Windows";

    // Windows => Edge jediné
    const isEdge = await isEdgeBrowser();
    if (isEdge) {
      edgeCheck.innerHTML = "✔️";
      edgeCheck.classList.add("checkmark");
    } else {
      edgeCheck.innerHTML = "❌ (chybí Edge)";
      edgeCheck.classList.add("error");
      edgeLink.style.display = "list-item";
      // Odkaz ke stažení Edge
      edgeLinkA.href = "https://www.microsoft.com/edge";
      allOk = false;
    }

    // Portál společnosti? (Na Windows store existuje?)
    const hasPortal = await hasCompanyPortal();
    if (hasPortal) {
      compCheck.innerHTML = "✔️";
      compCheck.classList.add("checkmark");
    } else {
      compCheck.innerHTML = "❌ (chybí Portál společnosti)";
      compCheck.classList.add("error");
      companyLink.style.display = "list-item";
      // Tady to moc smysl nedává, ale vyhovíme zadání
      // Můžete dát odkaz do MS Store:
      companyLinkA.href = "https://apps.microsoft.com/store/detail/intune-company-portal/9WZDNCRFJ3PZ";
      allOk = false;
    }

    // Zobrazíme links
    if (!allOk) {
      appLinks.style.display = "block";
    }
    if (allOk) {
      okbaseLink.style.display = "block";
    }

  } else {
    // Neznámé
    headline.textContent = "OKbase na neznámém zařízení";
    // Edge? Asi ne
    edgeCheck.innerHTML = "❓";
    compCheck.innerHTML = "❓";
    // Konec
  }
});
</script>

</body>
</html>
